# ============================================================
# WCACE SOC Scenarios - Suricata Local Rules
# ============================================================

# === SQL Injection Detection (Scenario 13) ===
alert http any any -> $SQL_SERVERS any (msg:"WCACE: SQL Injection - UNION SELECT"; flow:to_server,established; content:"UNION"; nocase; content:"SELECT"; nocase; distance:0; sid:9000001; rev:1; classtype:web-application-attack;)
alert http any any -> $SQL_SERVERS any (msg:"WCACE: SQL Injection - OR 1=1"; flow:to_server,established; content:"OR"; nocase; content:"1=1"; distance:0; sid:9000002; rev:1; classtype:web-application-attack;)
alert http any any -> $SQL_SERVERS any (msg:"WCACE: SQL Injection - Comment Injection"; flow:to_server,established; content:"--"; sid:9000003; rev:1; classtype:web-application-attack;)
alert http any any -> $SQL_SERVERS any (msg:"WCACE: SQL Injection - DROP TABLE"; flow:to_server,established; content:"DROP"; nocase; content:"TABLE"; nocase; distance:0; sid:9000004; rev:1; classtype:web-application-attack;)

# === Credential Stuffing / Brute Force (Scenario 14) ===
alert http any any -> $HTTP_SERVERS $HTTP_PORTS (msg:"WCACE: Multiple Login Attempts (Credential Stuffing)"; flow:to_server,established; content:"POST"; http_method; content:"/login"; http_uri; threshold:type both, track by_src, count 10, seconds 60; sid:9000010; rev:1; classtype:attempted-admin;)

# === DNS Tunnelling (Scenario 17) ===
alert dns any any -> any any (msg:"WCACE: DNS Tunnelling - Long Query"; dns.query; content:"."; pcre:"/^.{60,}/"; sid:9000020; rev:1; classtype:bad-unknown;)
alert dns any any -> any any (msg:"WCACE: DNS Tunnelling - High Entropy Subdomain"; dns.query; pcre:"/^[a-z0-9]{20,}\./"; sid:9000021; rev:1; classtype:bad-unknown;)
alert dns any any -> any any (msg:"WCACE: DNS Tunnelling - TXT Query Flood"; dns.query; content:".exfil."; nocase; threshold:type both, track by_src, count 20, seconds 60; sid:9000022; rev:1; classtype:bad-unknown;)

# === C2 Beaconing (Scenarios 10, 11) ===
alert http any any -> $EXTERNAL_NET any (msg:"WCACE: C2 Beaconing - Regular Interval"; flow:to_server,established; content:"GET"; http_method; content:"/beacon"; http_uri; threshold:type both, track by_src, count 5, seconds 300; sid:9000030; rev:1; classtype:trojan-activity;)
alert tls any any -> $EXTERNAL_NET any (msg:"WCACE: Suspicious TLS to Known C2 Domain"; tls.sni; content:"evil-cdn"; nocase; sid:9000031; rev:1; classtype:trojan-activity;)

# === Cryptojacking (Scenario 19) ===
alert http any any -> $EXTERNAL_NET any (msg:"WCACE: Cryptominer - Mining Pool Connection"; flow:to_server,established; content:"stratum+tcp"; sid:9000040; rev:1; classtype:policy-violation;)
alert http any any -> $EXTERNAL_NET any (msg:"WCACE: Cryptominer - CoinHive JS"; flow:to_server,established; content:"coinhive.min.js"; nocase; sid:9000041; rev:1; classtype:policy-violation;)
alert http any any -> $EXTERNAL_NET any (msg:"WCACE: Cryptominer - Mining Pool Domain"; flow:to_server,established; content:"pool.cryptomine"; nocase; sid:9000042; rev:1; classtype:policy-violation;)

# === Data Exfiltration (Scenarios 4, 9) ===
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"WCACE: Large Data Transfer to External"; flow:to_server,established; dsize:>10000; threshold:type both, track by_src, count 5, seconds 60; sid:9000050; rev:1; classtype:policy-violation;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg:"WCACE: Encrypted Exfiltration - High Volume HTTPS"; flow:to_server,established; threshold:type both, track by_src, count 100, seconds 300; sid:9000051; rev:1; classtype:policy-violation;)

# === Lateral Movement (Scenario 7) ===
alert tcp $HOME_NET any -> $HOME_NET 22 (msg:"WCACE: Internal SSH Scanning"; flow:to_server; flags:S; threshold:type both, track by_src, count 5, seconds 60; sid:9000060; rev:1; classtype:attempted-recon;)
alert tcp $HOME_NET any -> $HOME_NET 445 (msg:"WCACE: Internal SMB Scanning"; flow:to_server; flags:S; threshold:type both, track by_src, count 5, seconds 60; sid:9000061; rev:1; classtype:attempted-recon;)
alert tcp $HOME_NET any -> $HOME_NET 3389 (msg:"WCACE: Internal RDP Scanning"; flow:to_server; flags:S; threshold:type both, track by_src, count 5, seconds 60; sid:9000062; rev:1; classtype:attempted-recon;)

# === Phishing / Drive-By (Scenarios 8, 12, 18) ===
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"WCACE: Suspicious Executable Download"; flow:to_client,established; content:"Content-Type|3a| application/x-msdownload"; sid:9000070; rev:1; classtype:policy-violation;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"WCACE: Suspicious ZIP Download"; flow:to_client,established; content:".zip"; http_uri; content:"invoice"; nocase; sid:9000071; rev:1; classtype:policy-violation;)

# === API Attacks (Scenario 22) ===
alert http any any -> $HTTP_SERVERS any (msg:"WCACE: API Auth Bypass Attempt"; flow:to_server,established; content:"/api/"; http_uri; content:"admin"; http_uri; sid:9000080; rev:1; classtype:web-application-attack;)
alert http any any -> $HTTP_SERVERS any (msg:"WCACE: API Rate Limit Exceeded"; flow:to_server,established; content:"/api/"; http_uri; threshold:type both, track by_src, count 50, seconds 60; sid:9000081; rev:1; classtype:web-application-attack;)

# === Ransomware Indicators (Scenario 8, 20) ===
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"WCACE: Ransomware - Tor Connection Attempt"; flow:to_server,established; content:"|16 03|"; depth:2; content:".onion"; fast_pattern; sid:9000090; rev:1; classtype:trojan-activity;)

# === Privilege Escalation (Scenario 16) ===
alert tcp any any -> $HOME_NET any (msg:"WCACE: Potential Privilege Escalation Exploit"; flow:to_server,established; content:"/bin/sh"; sid:9000100; rev:1; classtype:attempted-admin;)
