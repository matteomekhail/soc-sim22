<!-- Scenario 14: Credential Stuffing Detection Rules for Wazuh -->
<group name="wcace,credential_stuffing,authentication,">

  <rule id="100200" level="6">
    <if_group>web|accesslog|authentication_failed</if_group>
    <match>Failed password|Invalid credentials|401</match>
    <description>WCACE S14: Authentication failure detected</description>
    <mitre>
      <id>T1110.004</id>
    </mitre>
    <group>authentication_failed,credential_stuffing,</group>
  </rule>

  <rule id="100201" level="10" frequency="10" timeframe="60">
    <if_matched_group>authentication_failed</if_matched_group>
    <same_source_ip />
    <description>WCACE S14: Multiple authentication failures from same IP - Possible credential stuffing</description>
    <mitre>
      <id>T1110.004</id>
    </mitre>
    <group>credential_stuffing,attack,</group>
  </rule>

  <rule id="100202" level="12" frequency="25" timeframe="120">
    <if_matched_group>credential_stuffing</if_matched_group>
    <same_source_ip />
    <description>WCACE S14: Credential stuffing attack confirmed - High volume auth failures from single IP</description>
    <mitre>
      <id>T1110.004</id>
    </mitre>
    <group>credential_stuffing,attack,</group>
  </rule>

  <rule id="100203" level="14">
    <if_group>authentication_success</if_group>
    <if_matched_group>credential_stuffing</if_matched_group>
    <same_source_ip />
    <description>WCACE S14: Account compromised - Successful login after credential stuffing attack</description>
    <mitre>
      <id>T1110.004</id>
      <id>T1078</id>
    </mitre>
    <group>credential_stuffing,account_compromise,</group>
  </rule>

  <rule id="100204" level="12" frequency="5" timeframe="120">
    <if_matched_group>authentication_failed</if_matched_group>
    <different_source_ip />
    <description>WCACE S14: Distributed credential stuffing - Auth failures from multiple IPs targeting same account</description>
    <mitre>
      <id>T1110.004</id>
    </mitre>
    <group>credential_stuffing,distributed_attack,</group>
  </rule>

</group>
